<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IP Reputation Checker</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f7f9fc;
      color: #333;
      margin: 0;
      padding: 40px;
      text-align: center;
    }

    h1 {
      margin-bottom: 20px;
      color: #222;
    }

    input {
      padding: 10px;
      width: 250px;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
      font-size: 15px;
    }

    button {
      padding: 10px 18px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      margin-left: 10px;
    }

    button:hover {
      background: #0056b3;
    }

    #riskLevel {
      margin-top: 25px;
      font-size: 20px;
      font-weight: bold;
      padding: 10px;
      border-radius: 8px;
      display: inline-block;
      width: 200px;
    }

    .result-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 30px;
    }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      padding: 20px;
      width: 280px;
      text-align: left;
    }

    .card h3 {
      margin-top: 0;
      color: #007bff;
      text-align: center;
    }

    table {
      margin: 30px auto;
      border-collapse: collapse;
      width: 90%;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    th, td {
      padding: 10px 15px;
      border-bottom: 1px solid #eee;
      text-align: center;
    }

    th {
      background: #f1f3f6;
      color: #333;
    }
  </style>
</head>
<body>
  <h1>IP Reputation Checker</h1>
  <input type="text" id="ipInput" placeholder="Enter IP address" />
  <button onclick="checkIP()">Check</button>

  <div id="riskLevel"></div>
  <div class="result-container" id="results"></div>
  <h2>Recently Checked IPs</h2>
  <table id="historyTable">
    <thead>
      <tr>
        <th>IP</th>
        <th>Abuse Score</th>
        <th>Country</th>
        <th>Checked At</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const history = [];

    async function checkIP() {
      const ip = document.getElementById("ipInput").value;
      if (!ip) return alert("Enter a valid IP address.");

      const response = await fetch("http://127.0.0.1:5000/check", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ ip }),
      });

      const data = await response.json();

      // Risk color logic based on AbuseIPDB score
      let score = data.abuse_score || 0;
      let riskBox = document.getElementById("riskLevel");
      if (score >= 75) {
        riskBox.textContent = "HIGH RISK";
        riskBox.style.background = "#ffcccc";
        riskBox.style.color = "#b30000";
      } else if (score >= 40) {
        riskBox.textContent = "MEDIUM RISK";
        riskBox.style.background = "#fff3cd";
        riskBox.style.color = "#8a6d3b";
      } else {
        riskBox.textContent = "LOW RISK";
        riskBox.style.background = "#d4edda";
        riskBox.style.color = "#155724";
      }

      // Display result cards
      document.getElementById("results").innerHTML = `
        <div class="card">
          <h3>AbuseIPDB</h3>
          <p><b>Abuse Score:</b> ${data.abuse_score || "N/A"}</p>
          <p><b>Total Reports:</b> ${data.total_reports || "N/A"}</p>
          <p><b>Country:</b> ${data.country || "Unknown"}</p>
        </div>
        <div class="card">
          <h3>VirusTotal</h3>
          <p><b>Malicious:</b> ${data.vt_malicious || 0}</p>
          <p><b>Suspicious:</b> ${data.vt_suspicious || 0}</p>
          <p><b>Harmless:</b> ${data.vt_harmless || 0}</p>
        </div>
        <div class="card">
          <h3>WHOIS</h3>
          <p><b>Organization:</b> ${data.whois_org || "N/A"}</p>
          <p><b>Country:</b> ${data.whois_country || "N/A"}</p>
        </div>
      `;

      // Add to history
      history.unshift({
        ip,
        score,
        country: data.country || "Unknown",
        time: new Date().toLocaleString(),
      });

      updateHistoryTable();
    }

    function updateHistoryTable() {
      const tbody = document.querySelector("#historyTable tbody");
      tbody.innerHTML = history
        .slice(0, 5)
        .map(
          (r) => `
        <tr>
          <td>${r.ip}</td>
          <td>${r.score}</td>
          <td>${r.country}</td>
          <td>${r.time}</td>
        </tr>`
        )
        .join("");
    }
  </script>
</body>
</html>
